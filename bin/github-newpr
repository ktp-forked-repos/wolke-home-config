#!/usr/bin/perl
use strict;
use warnings;

my $repo = "lillegroup/escribehost";
my @bases = qw(esh-develop legacy-develop);

sub main(@){
  my $curBranch = `git rev-parse --abbrev-ref HEAD 2>/dev/null`;
  chomp $curBranch;

  my $curBase = $bases[0];
  for my $base(@bases){
    system "git", "merge-base", "--is-ancestor", $base, $curBranch;
    if($? == 0){
      $curBase = $base;
      last;
    }
  }

  my $url = "https://github.com/$repo/compare/$curBase...$curBranch";
  print "$url\n";

  system "x-www-browser", $url;
}

&main(@ARGV);
