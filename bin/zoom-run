#!/usr/bin/perl
use strict;
use warnings;

my $defaultMeetingId = "362104616";

sub main(@){
  my $meetingId = $defaultMeetingId;
  if(@_ == 1 and $_[0] =~ /^\d+$/){
    $meetingId = $_[0];
  }elsif(@_ > 0){
    die "Usage: $0  or $0 MEETING_ID\n";
  }
  my $pgrep = `pgrep --exact zoom`;
  my @pids = $pgrep =~ /\d+/g;
  for my $pid(@pids){
    print "--$pid--\n";
  }

  if(@pids == 0){
    my $url = "zoommtg://zoom.us/join?action=join&confno=$meetingId";
    system "zoom '$url' &";
    system "pulse-vol mic mute";
    system "sleep 3";
    system "pulse-vol mic mute";
  }else{
    for my $pid(@pids){
      system "kill", "-9", $pid;
    }
  }
}

&main(@ARGV);
